import{r as i,A,j as e,a as E}from"./index-DXYuZLDw.js";import{C as D}from"./Card-BDWXq0O6.js";import{u as T,I as u,V as b,b as N,a as P}from"./form-hook-BonbRPbk.js";import{E as C,B as h,a as v}from"./axios-CcOVbyc0.js";import{I as M}from"./ImageUpload-9ARSYr1Z.js";const F=()=>{const m=i.useContext(A),[r,w]=i.useState(!0),[j,n]=i.useState(!1),[y,l]=i.useState(),[s,o,c]=T({email:{value:"",isValid:!1},password:{value:"",isValid:!1}},!1),L=()=>{r?c({...s.inputs,name:{value:"",isValid:!1},image:{value:null,isValid:!1}},!1):c({...s.inputs,name:void 0},s.inputs.email.isValid&&s.inputs.password.isValid),w(p=>!p)},S=async p=>{var g,x,f,I;if(p.preventDefault(),n(!0),r)try{let a={email:s.inputs.email.value,password:s.inputs.password.value};const d=await v.post("https://travel-diary-app-production.up.railway.app/api/users/login",a);console.log(d);const t=d.data;console.log(t),n(!1),m.login(t.userId,t.token,t.image)}catch(a){console.error(a),n(!1),l(((x=(g=a.response)==null?void 0:g.data)==null?void 0:x.message)||"Something went Wrong, Please try again later")}else try{let a=new FormData;a.append("name",s.inputs.name.value),a.append("email",s.inputs.email.value),a.append("password",s.inputs.password.value),a.append("image",s.inputs.image.value);const t=(await v.post("https://travel-diary-app-production.up.railway.app/api/users/signup",a)).data;console.log(t),n(!1),m.login(t.userId,t.token,t.image)}catch(a){console.error(a),n(!1),l(((I=(f=a.response)==null?void 0:f.data)==null?void 0:I.message)||"Something went Wrong, Please try again later")}},V=()=>{l(null)};return e.jsxs(e.Fragment,{children:[e.jsx(C,{error:y,onClear:V}),e.jsxs(D,{className:"authentication",children:[j&&e.jsx(E,{asOverlay:!0}),e.jsx("h2",{children:r?"Login":"SignUp"}),e.jsx("hr",{}),e.jsxs("form",{onSubmit:S,children:[!r&&e.jsx(u,{element:"input",id:"name",type:"text",label:"Your Name",validators:[b()],errorText:"Please enter a name.",onInput:o}),!r&&e.jsx(M,{id:"image",small:!0,onInput:o}),e.jsx(u,{element:"input",id:"email",type:"email",label:"E-Mail",validators:[N()],errorText:"Please enter a valid email address.",onInput:o}),e.jsx(u,{element:"input",id:"password",type:"password",label:"Password",validators:[P(6)],errorText:"Please enter a valid password, at least 6 characters.",onInput:o}),e.jsx(h,{type:"submit",disabled:!s.isValid,children:r?"LOGIN":"SIGNUP"})]}),e.jsxs(h,{inverse:!0,onClick:L,children:["SWITCH TO ",r?"SIGNUP":"LOGIN"]})]})]})};export{F as default};
